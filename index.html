<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Steal A Bra — Traders</title>
<style>
  :root{
    --bg:#f3f6fb; --card:#ffffff; --accent:#0066ff; --muted:#6b7280;
  }
  *{box-sizing:border-box;font-family:Inter,system-ui,Arial,Helvetica,sans-serif}
  body{margin:0;height:100vh;background:linear-gradient(180deg,#eef2ff,#f3f6fb);display:flex}
  .sidebar{width:220px;background:#0f1724;color:#fff;padding:20px;display:flex;flex-direction:column}
  .brand{font-weight:700;font-size:1.1rem;margin-bottom:18px}
  .nav button{background:transparent;border:0;color:#cbd5e1;padding:10px 0;text-align:left;cursor:pointer;width:100%}
  .nav button.active{color:#fff;background:rgba(255,255,255,0.03);border-radius:6px;padding-left:10px}
  .main{flex:1;padding:28px;overflow:auto}
  .card{background:var(--card);border-radius:10px;box-shadow:0 6px 18px rgba(12,22,50,0.06);padding:18px;max-width:980px;margin-bottom:20px}
  .row{display:flex;gap:12px;align-items:center}
  input, button, textarea{font-family:inherit}
  input,textarea{padding:10px;border-radius:8px;border:1px solid #e6e9ef;background:#fff;outline:none}
  input[type=email]{width:320px}
  input[type=text]{width:220px}
  input[type=password]{width:220px}
  button.primary{background:var(--accent);color:#fff;border:0;padding:10px 14px;border-radius:8px;cursor:pointer}
  button.ghost{background:transparent;border:1px solid #e6e9ef;padding:8px 10px;border-radius:8px;cursor:pointer}
  .muted{color:var(--muted);font-size:0.92rem}
  .list{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:12px;margin-top:12px}
  .trader{padding:12px;border-radius:8px;border:1px solid #eef2f8;background:#fff}
  .trader h4{margin:0 0 6px}
  .trader .meta{font-size:13px;color:var(--muted)}
  .trader .actions{margin-top:10px}
  .trader .actions button{margin-right:8px;padding:6px 10px;border-radius:8px;border:0;cursor:pointer}
  .btn-block{background:#ff4d4f;color:#fff}
  .btn-message{background:var(--accent);color:#fff}
  /* modal */
  .overlay{position:fixed;inset:0;background:rgba(2,6,23,0.56);display:none;align-items:center;justify-content:center;z-index:40}
  .modal{background:#fff;padding:18px;border-radius:10px;min-width:320px;max-width:560px;box-shadow:0 10px 30px rgba(2,6,23,0.3)}
  .modal h3{margin:0 0 8px}
  .footer-small{font-size:0.85rem;color:var(--muted);margin-top:8px}
  .success{color:green}
  .error{color:#b91c1c}
</style>
</head>
<body>
  <aside class="sidebar">
    <div class="brand">Steal A Bra</div>
    <nav class="nav">
      <button class="active" data-view="register">Create Account</button>
      <button data-view="traders">Traders</button>
      <button data-view="accounts">Accounts</button>
      <button data-view="settings">Settings</button>
    </nav>
    <div style="margin-top:auto;font-size:12px;color:#9aa4b2">Demo • not production-ready</div>
  </aside>

  <main class="main">
    <div id="register" class="card view">
      <h2>Create account</h2>
      <p class="muted">We'll send a verification code to your email — enter it to verify your account.</p>
      <form id="registerForm" class="row" onsubmit="return false;">
        <input id="email" type="email" placeholder="Email" required />
        <input id="displayName" type="text" placeholder="Display name" required />
        <input id="password" type="password" placeholder="Password" required />
        <button id="createBtn" class="primary">Create Account</button>
      </form>
      <div id="registerInfo" class="footer-small"></div>
    </div>

    <div id="traders" class="card view" style="display:none;">
      <h2>Traders</h2>
      <p class="muted">Verified traders are displayed here.</p>
      <div id="tradersList" class="list"></div>
    </div>

    <div id="accounts" class="card view" style="display:none;">
      <h2>Accounts</h2>
      <div id="accountsList" class="list"></div>
    </div>

    <div id="settings" class="card view" style="display:none;">
      <h2>Settings</h2>
      <p class="muted">No settings yet.</p>
    </div>
  </main>

  <!-- overlay modal -->
  <div id="overlay" class="overlay">
    <div class="modal">
      <h3 id="modalTitle">Enter verification code</h3>
      <p class="muted" id="modalDesc">We sent a code to your email. Enter it below to verify your account.</p>
      <input id="verifyEmail" type="email" placeholder="Email (auto-filled)" style="width:100%;margin-bottom:8px" />
      <input id="verifyCode" type="text" placeholder="6-digit code" style="width:100%;margin-bottom:8px" />
      <div style="text-align:right">
        <button class="ghost" onclick="closeOverlay()">Cancel</button>
        <button class="primary" onclick="submitVerification()">Verify</button>
      </div>
      <div id="verifyInfo" class="footer-small"></div>
    </div>
  </div>

<script>
  const API_ROOT = (location.hostname === 'localhost' || location.hostname === '127.0.0.1') ? 'http://localhost:3000/api' : 'https://YOUR_BACKEND_URL/api';
  // navigation
  document.querySelectorAll('.nav button').forEach(btn=>{
    btn.addEventListener('click', ()=> {
      document.querySelectorAll('.nav button').forEach(x=>x.classList.remove('active'));
      btn.classList.add('active');
      const view = btn.dataset.view;
      document.querySelectorAll('.view').forEach(v=>v.style.display = v.id === view ? '' : 'none');
      if(view === 'traders') loadTraders();
      if(view === 'accounts') loadAccounts();
    });
  });

  // register
  document.getElementById('createBtn').addEventListener('click', async (e)=>{
    e.preventDefault();
    const email = document.getElementById('email').value.trim();
    const displayName = document.getElementById('displayName').value.trim();
    const password = document.getElementById('password').value;

    // basic email validation
    const emailRe = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if(!emailRe.test(email)){ showRegisterInfo('Invalid email address', 'error'); return; }
    if(!displayName || password.length < 4){ showRegisterInfo('Missing display name or password too short', 'error'); return; }

    showRegisterInfo('Creating account & sending verification code...', '');
    try {
      const res = await fetch(`${API_ROOT}/register`, {
        method:'POST', headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ email, displayName, password })
      });
      const j = await res.json();
      if(!res.ok) {
        showRegisterInfo(j.error || 'Failed to create account', 'error');
        return;
      }
      showRegisterInfo('Verification code sent — check your email', 'success');
      openOverlay(email);
    } catch(err){
      console.error(err);
      showRegisterInfo('Server error — make sure backend is running', 'error');
    }
  });

  function showRegisterInfo(text, type=''){
    const el = document.getElementById('registerInfo');
    el.textContent = text;
    el.className = type === 'error' ? 'error' : (type === 'success' ? 'success' : 'footer-small');
  }

  // overlay modal
  function openOverlay(prefillEmail=''){
    document.getElementById('overlay').style.display = 'flex';
    document.getElementById('verifyEmail').value = prefillEmail;
    document.getElementById('verifyCode').value = '';
    document.getElementById('verifyInfo').textContent = '';
  }
  function closeOverlay(){ document.getElementById('overlay').style.display = 'none'; }

  async function submitVerification(){
    const email = document.getElementById('verifyEmail').value.trim();
    const code = document.getElementById('verifyCode').value.trim();
    if(!email || !code) { document.getElementById('verifyInfo').textContent = 'Fill both fields'; return; }
    document.getElementById('verifyInfo').textContent = 'Verifying...';
    try {
      const res = await fetch(`${API_ROOT}/verify`, {
        method:'POST', headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ email, code })
      });
      const j = await res.json();
      if(res.ok){
        document.getElementById('verifyInfo').textContent = 'Verified! You can now see your account in Traders.';
        setTimeout(()=>{ closeOverlay(); loadTraders(); }, 900);
      } else {
        document.getElementById('verifyInfo').textContent = j.error || 'Invalid code';
      }
    } catch(err){
      console.error(err);
      document.getElementById('verifyInfo').textContent = 'Server error';
    }
  }

  // load traders (only verified)
  async function loadTraders(){
    try {
      const res = await fetch(`${API_ROOT}/traders`);
      const list = await res.json();
      const container = document.getElementById('tradersList');
      container.innerHTML = '';
      if(list.length === 0){ container.innerHTML = '<div class="muted">No verified traders yet</div>'; return; }
      list.forEach(t=>{
        const div = document.createElement('div'); div.className = 'trader';
        div.innerHTML = `<h4>${escapeHtml(t.displayName)}</h4><div class="meta">${escapeHtml(t.email)}</div>
          <div class="actions"><button class="btn-message" onclick="openMessage('${escapeHtml(t.email)}')">Message</button>
          <button class="btn-block" onclick="blockUser('${escapeHtml(t.email)}')">Block</button></div>`;
        container.appendChild(div);
      });
    } catch(err){ console.error(err); }
  }

  // load accounts (all)
  async function loadAccounts(){
    try {
      const res = await fetch(`${API_ROOT}/accounts`);
      const list = await res.json();
      const container = document.getElementById('accountsList');
      container.innerHTML = '';
      if(list.length === 0){ container.innerHTML = '<div class="muted">No accounts yet</div>'; return; }
      list.forEach(a=>{
        const div = document.createElement('div'); div.className = 'trader';
        div.innerHTML = `<h4>${escapeHtml(a.displayName)}</h4><div class="meta">${escapeHtml(a.email)} • ${a.verified ? 'Verified' : 'Unverified'}</div>`;
        container.appendChild(div);
      });
    } catch(err){ console.error(err); }
  }

  // block/message (demo)
  async function blockUser(email){
    await fetch(`${API_ROOT}/block`, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ email }) });
    alert('Blocked (demo)');
  }
  function openMessage(email){
    const text = prompt('Message to ' + email + ':');
    if(!text) return;
    fetch(`${API_ROOT}/message`, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ email, text })});
    alert('Message sent (demo).');
  }

  function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;',\"'\":'&#39;'})[c]); }

  // initial
  // show register view by default
  document.querySelector('.nav button[data-view="register"]').click();
</script>
</body>
</html>
